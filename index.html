<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Quiz Buzzer</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Nunito:wght@400;600;700;900&display=swap" rel="stylesheet">

<style>

body{
background:#0d0d0d;
color:white;
font-family:Nunito;
text-align:center;
padding-top:40px;
}

.btn{
padding:15px 30px;
font-size:20px;
margin:10px;
cursor:pointer;
}

input{
padding:10px;
font-size:18px;
}

#winner{
font-size:40px;
color:gold;
margin-top:20px;
}

</style>

</head>

<body>


<h1>QUIZ BUZZER</h1>


<div id="joinScreen">

<input id="name" placeholder="Enter Name">

<br><br>

<button class="btn" onclick="join()">JOIN</button>

</div>


<div id="buzzScreen" style="display:none">

<button class="btn" id="buzzBtn" onclick="buzz()">BUZZ</button>

<button class="btn" onclick="reset()">RESET</button>

<div id="winner"></div>

</div>


<script>


const supabase = window.supabase.createClient(

"https://snayhpmkgnuwyfgzmbpi.supabase.co",

"sb_publishable_TVaiPvD2tRCGMXvfWBhKAg_7CXdSRL4"

);


let myName="";
let buzzLocked=false;



function join(){

myName=document.getElementById("name").value;

if(!myName){

alert("Enter name");

return;

}

document.getElementById("joinScreen").style.display="none";
document.getElementById("buzzScreen").style.display="block";

}



// BUZZ
async function buzz(){

if(buzzLocked) return;

buzzLocked=true;

document.getElementById("buzzBtn").disabled=true;


// check if already someone buzzed

const { data } = await supabase
.from("buzzers")
.select("*")
.limit(1);


if(data.length>0){

return;
}


// insert winner

await supabase

.from("buzzers")

.insert({

name:myName,

time:new Date()

});

}



// RESET
async function reset(){

buzzLocked=false;

document.getElementById("buzzBtn").disabled=false;

document.getElementById("winner").innerHTML="";


await supabase

.from("buzzers")

.delete()

.neq("id",0);

}



// REALTIME LISTENER

supabase

.channel("buzzers")

.on(

"postgres_changes",

{

event:"INSERT",

schema:"public",

table:"buzzers"

},

payload=>{

buzzLocked=true;

document.getElementById("buzzBtn").disabled=true;

document.getElementById("winner").innerHTML=

"üèÜ "+payload.new.name+" buzzed first";

}

)

.subscribe();



</script>


</body>

</html>
