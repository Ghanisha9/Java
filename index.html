<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Buzzer</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>

body{
background:black;
color:white;
text-align:center;
font-family:Arial;
}

#buzzBtn{
font-size:50px;
background:red;
color:white;
padding:20px;
}

#winner{
font-size:40px;
color:gold;
}

</style>

</head>

<body>

<h1>Quiz Buzzer</h1>

<input id="name" placeholder="Enter name">

<br><br>

<button onclick="join()">JOIN</button>

<button onclick="host()">HOST</button>

<div id="game" style="display:none">

<br>

<input type="file" id="logoUpload">

<br><br>

<img id="logo" width="300">

<br><br>

<button id="buzzBtn" onclick="buzz()">BUZZ</button>

<br><br>

<button onclick="next()">NEXT</button>

<div id="winner"></div>

</div>


<script>

const supabase = window.supabase.createClient(
"https://snayhpmkgnuwyfgzmbpi.supabase.co",
"sb_publishable_TVaiPvD2tRCGMXvfWBhKAg_7CXdSRL4"
);

let myName="";
let isHost=false;
let locked=false;

function join(){

myName=document.getElementById("name").value;

document.getElementById("game").style.display="block";

listen();

}

function host(){

myName="HOST";

isHost=true;

document.getElementById("game").style.display="block";

listen();

}

document.getElementById("logoUpload").onchange=function(e){

if(!isHost)return;

const reader=new FileReader();

reader.onload=async function(){

await supabase.from("state").update({

logo:reader.result,
winner:""

}).eq("id",1);

};

reader.readAsDataURL(e.target.files[0]);

};


async function buzz(){

if(locked)return;

locked=true;

await supabase.from("state").update({

winner:myName

}).eq("id",1);

}


async function next(){

if(!isHost)return;

locked=false;

await supabase.from("state").update({

winner:""

}).eq("id",1);

}


function listen(){

supabase.channel("state")

.on("postgres_changes",{

event:"UPDATE",
schema:"public",
table:"state"

},

payload=>{

document.getElementById("logo").src=payload.new.logo;

if(payload.new.winner){

locked=true;

document.getElementById("winner").innerHTML="Winner: "+payload.new.winner;

}else{

locked=false;

document.getElementById("winner").innerHTML="";

}

})

.subscribe();

}

</script>

</body>
</html>
